# AlertManager é…ç½®æ–‡ä»¶
global:
  # SMTP é…ç½®
  smtp_smarthost: 'smtp.gmail.com:587'
  smtp_from: 'ryan-mall-alerts@example.com'
  smtp_auth_username: 'your-email@gmail.com'
  smtp_auth_password: 'your-app-password'
  
  # é»˜è®¤æ¥æ”¶è€…
  smtp_require_tls: true

# æ¨¡æ¿é…ç½®
templates:
  - '/etc/alertmanager/templates/*.tmpl'

# è·¯ç”±é…ç½®
route:
  # é»˜è®¤æ¥æ”¶è€…
  receiver: 'default-receiver'
  
  # åˆ†ç»„é…ç½®
  group_by: ['alertname', 'cluster', 'service']
  group_wait: 10s
  group_interval: 10s
  repeat_interval: 1h
  
  # è·¯ç”±è§„åˆ™
  routes:
    # å…³é”®å‘Šè­¦ - ç«‹å³é€šçŸ¥
    - match:
        severity: critical
      receiver: 'critical-alerts'
      group_wait: 0s
      group_interval: 5m
      repeat_interval: 15m
      
    # è­¦å‘Šå‘Šè­¦ - å»¶è¿Ÿé€šçŸ¥
    - match:
        severity: warning
      receiver: 'warning-alerts'
      group_wait: 30s
      group_interval: 10m
      repeat_interval: 1h
      
    # Redisç›¸å…³å‘Šè­¦
    - match:
        service: redis
      receiver: 'redis-alerts'
      group_wait: 10s
      
    # MySQLç›¸å…³å‘Šè­¦
    - match:
        service: mysql
      receiver: 'mysql-alerts'
      group_wait: 10s
      
    # åº”ç”¨ç¨‹åºå‘Šè­¦
    - match:
        service: ryan-mall
      receiver: 'app-alerts'
      group_wait: 5s

# æŠ‘åˆ¶è§„åˆ™
inhibit_rules:
  # å¦‚æœåº”ç”¨å®•æœºï¼ŒæŠ‘åˆ¶å…¶ä»–ç›¸å…³å‘Šè­¦
  - source_match:
      alertname: 'RyanMallAppDown'
    target_match:
      service: 'ryan-mall'
    equal: ['instance']
    
  # å¦‚æœRedisé›†ç¾¤å®•æœºï¼ŒæŠ‘åˆ¶å•ä¸ªèŠ‚ç‚¹å‘Šè­¦
  - source_match:
      alertname: 'RedisClusterStateError'
    target_match:
      alertname: 'RedisNodeDown'
    equal: ['cluster']

# æ¥æ”¶è€…é…ç½®
receivers:
  # é»˜è®¤æ¥æ”¶è€…
  - name: 'default-receiver'
    email_configs:
      - to: 'admin@example.com'
        subject: '[Ryan Mall] ç›‘æ§å‘Šè­¦'
        body: |
          å‘Šè­¦è¯¦æƒ…:
          - å‘Šè­¦åç§°: {{ .GroupLabels.alertname }}
          - ä¸¥é‡ç¨‹åº¦: {{ .GroupLabels.severity }}
          - æœåŠ¡åç§°: {{ .GroupLabels.service }}
          - å‘Šè­¦æ—¶é—´: {{ .CommonAnnotations.summary }}
          - è¯¦ç»†æè¿°: {{ .CommonAnnotations.description }}
          
          æŸ¥çœ‹è¯¦æƒ…: http://localhost:3000

  # å…³é”®å‘Šè­¦æ¥æ”¶è€…
  - name: 'critical-alerts'
    email_configs:
      - to: 'admin@example.com,ops@example.com'
        subject: '[CRITICAL] Ryan Mall å…³é”®å‘Šè­¦'
        body: |
          ğŸš¨ å…³é”®å‘Šè­¦ ğŸš¨
          
          å‘Šè­¦åç§°: {{ .GroupLabels.alertname }}
          æœåŠ¡åç§°: {{ .GroupLabels.service }}
          å‘Šè­¦æ—¶é—´: {{ .FireTime }}
          
          {{ range .Alerts }}
          - å®ä¾‹: {{ .Labels.instance }}
          - æè¿°: {{ .Annotations.description }}
          {{ end }}
          
          è¯·ç«‹å³å¤„ç†ï¼
          ç›‘æ§é¢æ¿: http://localhost:3000
    
    # Webhook é€šçŸ¥ï¼ˆå¯é€‰ï¼‰
    webhook_configs:
      - url: 'http://localhost:8080/api/v1/alerts/webhook'
        send_resolved: true

  # è­¦å‘Šå‘Šè­¦æ¥æ”¶è€…
  - name: 'warning-alerts'
    email_configs:
      - to: 'ops@example.com'
        subject: '[WARNING] Ryan Mall è­¦å‘Šå‘Šè­¦'
        body: |
          âš ï¸ è­¦å‘Šå‘Šè­¦ âš ï¸
          
          å‘Šè­¦åç§°: {{ .GroupLabels.alertname }}
          æœåŠ¡åç§°: {{ .GroupLabels.service }}
          
          {{ range .Alerts }}
          - å®ä¾‹: {{ .Labels.instance }}
          - æè¿°: {{ .Annotations.description }}
          {{ end }}
          
          ç›‘æ§é¢æ¿: http://localhost:3000

  # Rediså‘Šè­¦æ¥æ”¶è€…
  - name: 'redis-alerts'
    email_configs:
      - to: 'dba@example.com'
        subject: '[Redis] ç¼“å­˜ç³»ç»Ÿå‘Šè­¦'
        body: |
          ğŸ”´ Rediså‘Šè­¦ ğŸ”´
          
          å‘Šè­¦åç§°: {{ .GroupLabels.alertname }}
          é›†ç¾¤åç§°: {{ .GroupLabels.cluster }}
          
          {{ range .Alerts }}
          - èŠ‚ç‚¹: {{ .Labels.instance }}
          - æè¿°: {{ .Annotations.description }}
          {{ end }}
          
          Redisç›‘æ§: http://localhost:3000/d/redis

  # MySQLå‘Šè­¦æ¥æ”¶è€…
  - name: 'mysql-alerts'
    email_configs:
      - to: 'dba@example.com'
        subject: '[MySQL] æ•°æ®åº“å‘Šè­¦'
        body: |
          ğŸ”µ MySQLå‘Šè­¦ ğŸ”µ
          
          å‘Šè­¦åç§°: {{ .GroupLabels.alertname }}
          æ•°æ®åº“: {{ .GroupLabels.instance }}
          
          {{ range .Alerts }}
          - æè¿°: {{ .Annotations.description }}
          {{ end }}
          
          MySQLç›‘æ§: http://localhost:3000/d/mysql

  # åº”ç”¨ç¨‹åºå‘Šè­¦æ¥æ”¶è€…
  - name: 'app-alerts'
    email_configs:
      - to: 'dev@example.com'
        subject: '[App] Ryan Mallåº”ç”¨å‘Šè­¦'
        body: |
          ğŸŸ¡ åº”ç”¨å‘Šè­¦ ğŸŸ¡
          
          å‘Šè­¦åç§°: {{ .GroupLabels.alertname }}
          åº”ç”¨å®ä¾‹: {{ .GroupLabels.instance }}
          
          {{ range .Alerts }}
          - æè¿°: {{ .Annotations.description }}
          {{ end }}
          
          åº”ç”¨ç›‘æ§: http://localhost:3000/d/ryan-mall

# é™é»˜é…ç½®ç¤ºä¾‹
# silences:
#   - matchers:
#       - name: alertname
#         value: HighCPUUsage
#     startsAt: "2023-01-01T00:00:00Z"
#     endsAt: "2023-01-01T01:00:00Z"
#     createdBy: admin
#     comment: "ç»´æŠ¤æœŸé—´é™é»˜CPUå‘Šè­¦"
