# 🌐 Ryan Mall API 拓扑图指南

## 📋 目录
- [概述](#概述)
- [服务架构拓扑](#服务架构拓扑)
- [API端点拓扑](#api端点拓扑)
- [业务流程拓扑](#业务流程拓扑)
- [服务间依赖关系](#服务间依赖关系)
- [API分类说明](#api分类说明)

## 🎯 概述

本文档通过可视化拓扑图的方式，全面展示Ryan Mall电商系统的API架构、服务关系和业务流程，帮助开发者快速理解系统结构和API调用关系。

### 📊 拓扑图类型

1. **服务架构拓扑图** - 展示系统整体架构和服务间依赖
2. **API端点详细拓扑图** - 展示所有API端点和权限要求
3. **业务流程拓扑图** - 展示典型业务流程和API调用序列

## 🏗️ 服务架构拓扑

### 架构层次

```
🌐 客户端层
    ↓
🚪 API网关层 (Gin Router :8080)
    ↓
🔐 中间件层 (认证 + 监控)
    ↓
🏗️ 业务服务层 (5个核心服务)
    ↓
💾 数据访问层 (Repository层)
    ↓
🗄️ 数据存储层 (MySQL + Redis)
```

### 核心服务

| 服务 | 职责 | 依赖 |
|------|------|------|
| **👤 用户服务** | 用户认证、个人信息管理 | UserRepository → MySQL |
| **📦 商品服务** | 商品CRUD、库存管理 | ProductRepository → MySQL + Redis |
| **🏷️ 分类服务** | 分类管理、层级结构 | CategoryRepository → MySQL |
| **🛒 购物车服务** | 购物车管理、商品验证 | CartRepository + ProductRepository → MySQL |
| **📋 订单服务** | 订单处理、库存扣减 | OrderRepository + CartRepository + ProductRepository → MySQL |

### 服务间调用关系

```
订单服务 ──验证商品库存──→ 商品服务
订单服务 ──获取购物车──→ 购物车服务
购物车服务 ──验证商品状态──→ 商品服务
商品服务 ──验证分类──→ 分类服务
```

## 🔗 API端点拓扑

### API分类体系

#### 🌍 公共API (无需认证)
- **健康检查**: `GET /health`
- **系统状态**: `GET /cache/stats`, `GET /db/stats`
- **监控指标**: `GET /metrics`
- **用户注册**: `POST /api/v1/register`
- **用户登录**: `POST /api/v1/login`
- **商品浏览**: `GET /api/v1/products`, `GET /api/v1/products/:id`
- **分类浏览**: `GET /api/v1/categories/*`

#### 🔐 认证API (需要JWT Token)
- **用户管理**: `GET|PUT /api/v1/profile`, `POST /api/v1/change-password`
- **购物车操作**: `POST|GET|PUT|DELETE /api/v1/cart/*`
- **订单操作**: `POST|GET /api/v1/orders/*`

#### 👨‍💼 管理员API (需要认证+管理员权限)
- **商品管理**: `POST|PUT|DELETE /api/v1/products/*`
- **分类管理**: `POST|PUT|DELETE /api/v1/categories/*`
- **用户管理**: `GET /api/v1/users/:id`

### API端点统计

| 服务类型 | 端点数量 | 公开API | 认证API | 管理员API |
|----------|----------|---------|---------|-----------|
| **用户服务** | 8个 | 2个 | 5个 | 1个 |
| **商品服务** | 7个 | 3个 | 0个 | 4个 |
| **分类服务** | 8个 | 5个 | 0个 | 3个 |
| **购物车服务** | 9个 | 0个 | 9个 | 0个 |
| **订单服务** | 8个 | 0个 | 8个 | 0个 |
| **监控服务** | 4个 | 4个 | 0个 | 0个 |
| **总计** | **44个** | **14个** | **22个** | **8个** |

## 🔄 业务流程拓扑

### 典型业务流程

#### 1. 👤 用户认证流程
```
用户访问 → 检查注册状态 → 注册/登录 → 获取JWT Token → 访问认证API
```

#### 2. 📦 商品浏览流程
```
获取分类 → 浏览商品列表 → 查看商品详情 → 添加到购物车
```

#### 3. 🛒 购物车管理流程
```
查看购物车 → 修改数量 → 移除商品 → 查看汇总 → 确认下单
```

#### 4. 📋 订单处理流程
```
创建订单 → 验证库存 → 扣减库存 → 清空购物车 → 支付订单 → 确认收货
```

#### 5. 👨‍💼 管理员管理流程
```
管理员登录 → 创建分类 → 创建商品 → 管理库存 → 查看统计
```

### 关键业务节点

| 节点 | 涉及服务 | 关键验证 |
|------|----------|----------|
| **添加购物车** | 购物车服务 + 商品服务 | 商品状态、库存验证 |
| **创建订单** | 订单服务 + 购物车服务 + 商品服务 | 库存验证、事务处理 |
| **支付订单** | 订单服务 | 订单状态验证 |
| **库存管理** | 商品服务 | 库存数量验证 |

## 🔗 服务间依赖关系

### 依赖层次图

```
订单服务 (最高层)
    ├── 依赖购物车服务
    ├── 依赖商品服务
    └── 依赖用户服务(间接)

购物车服务 (中间层)
    ├── 依赖商品服务
    └── 依赖用户服务(间接)

商品服务 (中间层)
    └── 依赖分类服务

分类服务 (基础层)
    └── 无依赖

用户服务 (基础层)
    └── 无依赖
```

### 数据流向

```
客户端请求
    ↓
API网关 (路由分发)
    ↓
认证中间件 (JWT验证)
    ↓
业务服务 (业务逻辑处理)
    ↓
数据访问层 (数据库操作)
    ↓
数据存储 (MySQL/Redis)
```

## 📊 API分类说明

### 权限级别

| 级别 | 标识 | 说明 | 示例 |
|------|------|------|------|
| **公开** | 🌍 | 无需认证，任何人可访问 | 商品浏览、用户注册 |
| **认证** | 🔐 | 需要JWT Token | 购物车操作、订单管理 |
| **管理员** | 👨‍💼 | 需要认证+管理员权限 | 商品管理、分类管理 |

### HTTP方法分布

| 方法 | 数量 | 用途 |
|------|------|------|
| **GET** | 23个 | 数据查询 |
| **POST** | 12个 | 数据创建 |
| **PUT** | 7个 | 数据更新 |
| **DELETE** | 6个 | 数据删除 |

### 响应格式

所有API统一使用JSON格式响应：

```json
{
  "code": 200,
  "message": "操作成功",
  "data": { ... }
}
```

## 🎯 使用建议

### 开发者指南

1. **新功能开发**
   - 参考服务架构拓扑图确定服务归属
   - 按照API分类规范设计端点
   - 遵循业务流程拓扑设计调用链

2. **API调用顺序**
   - 先调用认证API获取Token
   - 按业务流程图调用相关API
   - 注意服务间依赖关系

3. **错误处理**
   - 参考错误处理流程图
   - 实现统一的错误响应格式
   - 添加适当的监控指标

### 测试建议

1. **单元测试**: 针对每个服务的API端点
2. **集成测试**: 验证服务间调用关系
3. **流程测试**: 按业务流程拓扑进行端到端测试

---

**通过这些拓扑图，开发者可以快速理解Ryan Mall系统的整体架构和API设计，提高开发效率和代码质量。** 🚀
